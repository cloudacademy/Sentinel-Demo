# This policy uses the Sentinel tfplan import to restrict the
# creation of Kubernetes deployments without Namespaces
# if the current plan were to be applied.

import "tfplan-functions" as plan

allDeployments = plan.find_resources("kubernetes_deployment")

not_namespaced = plan.filter_attribute_is_value(allDeployments, "namespace", "", true)

violations = length(not_namespaced)

main = rule { 
   violations is 0
}